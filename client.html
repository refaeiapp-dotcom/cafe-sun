<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ุทูุจ ูุดุฑูุจุงุช โ ุทุงููุฉ</title>
<style>
body{
    font-family:Arial;
    direction:rtl;
    background:#f2f2f2;
    padding:20px;
}
h1{text-align:center;}
.item{
    background:#fff;
    padding:10px;
    margin-bottom:8px;
    border-radius:6px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
select{padding:5px;}
.total{
    background:#fff;
    padding:15px;
    margin-top:15px;
    border-radius:6px;
    text-align:center;
    font-size:18px;
    font-weight:bold;
}
button{
    width:100%;
    padding:15px;
    margin-top:10px;
    font-size:17px;
    border:none;
    border-radius:6px;
    color:#fff;
    cursor:pointer;
}
.pending{background:#dc3545;} /* ุฃุญูุฑ */
.accepted{background:#28a745;} /* ุฃุฎุถุฑ */
.yellow{background:#ffc107;} /* ุฃุตูุฑ */
.status-text{
    font-size:14px;
    text-align:center;
    margin-bottom:5px;
    color:#444;
}
</style>
</head>
<body>

<h1 id="tableTitle">ูุงุฆูุฉ ุงูุทูุจุงุช โ ุทุงููุฉ ุฑูู</h1>

<!-- ุงูุฃุตูุงู -->
<div class="item"><span>ุดุงู (20)</span>
<select data-price="45"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูููุฉ (25)</span>
<select data-price="23"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูููุฉ ูุฑูุณุงูู (45)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูุณูู (25)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุญููุฉ (25)</span>
<select data-price="10"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูุงูุงู (45)</span>
<select data-price="50"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุณุญูุจ ุณุงุฏุฉ (50)</span>
<select data-price="38"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุณุญูุจ ุจุงูููุณุฑุงุช (70)</span>
<select data-price="20"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุณุญูุจ ููุงูู (70)</span>
<select data-price="12"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููุช ุณูุฏุฑ (60)</span>
<select data-price="22"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูุงุชูู ุจูุฏู (60)</span>
<select data-price="45"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูุงุชูู ูุงููููุง (60)</span>
<select data-price="23"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูุงุชูู ููุงุณู (60)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุจุฑูู (40)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููุงู (10)</span>
<select data-price="10"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุจูุจุณู (40)</span>
<select data-price="50"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููุฑูุฏุง (40)</span>
<select data-price="38"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุณูู ุงุจ (40)</span>
<select data-price="20"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููุฑูุฒ (40)</span>
<select data-price="12"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุงุณุชูุฌ (40)</span>
<select data-price="22"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุนุตูุฑ ุจุฑุชูุงู (80)</span>
<select data-price="45"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุนุตูุฑ ูุงูุฌู (80)</span>
<select data-price="23"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุนุตูุฑ ูุฑุงููุฉ (80)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุนูุงุจ (50)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุฒุจุงุฏู (80)</span>
<select data-price="10"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููุฒ ุจุงููุจู  (80)</span>
<select data-price="50"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุฒุจุงุฏู ุจุงูููุงูู (80)</span>
<select data-price="38"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุงูุณ ูููู (70)</span>
<select data-price="20"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุงูุณ ูุงุชูู (70)</span>
<select data-price="12"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุงูุฑูู (70)</span>
<select data-price="22"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุฑูุฏ ุจูู (100)</span>
<select data-price="45"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููููู ูุนูุงุน (50)</span>
<select data-price="23"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ูุฑูุช ุณูุงุท (120)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุงูุณ ุดููููุงุชุฉ (80)</span>
<select data-price="55"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููุช ุดููููุงุชุฉ  (80)</span>
<select data-price="10"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ููููุชู (70)</span>
<select data-price="50"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุญุฌุฑ ูุต (20)</span>
<select data-price="38"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุญุฌุฑ ุณููู (20)</span>
<select data-price="20"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุญุฌุฑ ููุงูู (100)</span>
<select data-price="12"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>
<div class="item"><span>ุญุฌุฑ ููุณ (100)</span>
<select data-price="22"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select></div>

<div class="total">
๐ฐ ุงููุฌููุน: <span id="total">0</span> ุฌููู
</div>

<div class="status-text" id="orderStatus"></div>
<button id="orderBtn" class="pending">ุฅุฑุณุงู ุงูุทูุจ</button>

<div class="status-text" id="billStatus"></div>
<button id="billBtn" class="pending">ุทูุจ ุงูุญุณุงุจ</button>

<div class="status-text" id="callStatus"></div>
<button id="callBtn" class="pending">ูุฏุงุก ุงูุฅุฏุงุฑุฉ (ุทูุงุฑุฆ)</button>

<div class="status-text">๐ค ูุชู ุงูุฅุฑุณุงู ุฅูู ููุญุฉ ุงูุชุญูู (ุงููุฏูุฑ)</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCXk63HWqwQMaNAOrb5HgVRaRgF998I3jo",
  authDomain: "kosharyapp.firebaseapp.com",
  databaseURL: "https://kosharyapp-default-rtdb.firebaseio.com",
  projectId: "kosharyapp",
  storageBucket: "kosharyapp.firebasestorage.app",
  messagingSenderId: "129714098738",
  appId: "1:129714098738:web:aa5c0aab07191dfa2be22b",
  measurementId: "G-G8SDKEN0RW"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const urlParams = new URLSearchParams(window.location.search);
const tableNum = urlParams.get("table") || 1;
document.getElementById("tableTitle").innerText = `ูุงุฆูุฉ ุงูุทูุจุงุช โ ุทุงููุฉ ุฑูู ${tableNum}`;

window.onload = function(){
    const selects = document.querySelectorAll("select");
    const totalSpan = document.getElementById("total");

    // ุชุญุฏูุซ ุงููุฌููุน
    selects.forEach(s=>{
        s.onchange = ()=>{
            let total=0;
            selects.forEach(el=>{
                total += el.dataset.price * el.value;
            });
            totalSpan.innerText = total;
        };
    });

    function waitManager(btn,statusDiv){
        btn.classList.add("pending");
        btn.classList.remove("accepted","yellow");
        document.getElementById(statusDiv).innerText = "โณ ูู ุงูุชุธุงุฑ ุงุณุชุฌุงุจุฉ ุงููุฏูุฑ...";
    }

    function updateButtonStatus(btn,statusDiv,status){
        btn.classList.remove("pending","accepted","yellow");
        if(status==="pending") btn.classList.add("pending");
        else if(status==="accepted") btn.classList.add("accepted");
        else if(status==="inProgress") btn.classList.add("yellow");

        let textMap = {
            pending:"โณ ูู ุงูุชุธุงุฑ ุงุณุชุฌุงุจุฉ ุงููุฏูุฑ...",
            accepted:"โ๏ธ ุชู ุชุฃููุฏ ุงูุทูุจ",
            inProgress:"๐ ุฌุงุฑู ุงูุชุญุถูุฑ"
        };
        document.getElementById(statusDiv).innerText = textMap[status] || "";
    }

    // ุฅุฑุณุงู ุงูุทูุจ
    document.getElementById("orderBtn").onclick = function(){
        waitManager(this,"orderStatus");
        const items = [];
        selects.forEach(el=>{
            if(el.value>0){
                items.push({
                    name: el.parentElement.querySelector("span").innerText.split(" (")[0],
                    qty: parseInt(el.value),
                    price: parseInt(el.dataset.price)
                });
            }
        });
        if(items.length===0){alert("ุงุฎุชุฑ ุนูู ุงูุฃูู ุตูู ูุงุญุฏ"); return;}

        const orderRef = push(ref(db, "orders"));
        set(orderRef,{
            tableNum: tableNum,
            workerNum: null,
            items: items,
            totalPrice: items.reduce((a,b)=>a+b.price*b.qty,0),
            status: "pending"
        }).then(()=> updateButtonStatus(document.getElementById("orderBtn"),"orderStatus","pending"))
          .catch(err=>{console.error(err); alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุฑุณุงู");});
    };

    // ุทูุจ ุงูุญุณุงุจ
    document.getElementById("billBtn").onclick = function(){
        waitManager(this,"billStatus");
        const billRef = push(ref(db, "bills"));
        set(billRef,{
            tableNum: tableNum,
            status:"pending"
        });

        const ordersRef = ref(db,"orders");
        onValue(ordersRef, snapshot=>{
            const data = snapshot.val() || {};
            Object.keys(data).forEach(key=>{
                if(data[key].tableNum == tableNum){
                    update(ref(db,"orders/"+key), { status:"bill" });
                }
            });
        }, {onlyOnce:true});
    };

    // ูุฏุงุก ุงูุฅุฏุงุฑุฉ
    document.getElementById("callBtn").onclick = function(){
        waitManager(this,"callStatus");
        const callRef = push(ref(db, "calls"));
        set(callRef,{
            tableNum:tableNum,
            status:"pending"
        });
    };

    // ======== ุงูุงุณุชูุงุน ูุชุญุฏูุซ ุงูุทูุจุงุช ========
    const ordersRef = ref(db, "orders");
    onValue(ordersRef, snapshot=>{
        snapshot.forEach(child=>{
            const order = child.val();
            if(order.tableNum==tableNum){
                const orderBtn = document.getElementById("orderBtn");

                // ุฅุฐุง ุงูุญุงูุฉ bill (ุฃุฒุฑู)ุ ูุนูุฏ ุงูููู ุงูุฃุญูุฑ ูุญูููุง ููุท
                if(order.status === "bill"){
                    orderBtn.classList.remove("accepted","yellow","pending");
                    orderBtn.classList.add("pending"); // ุงูููู ุงูุฃุญูุฑ
                    document.getElementById("orderStatus").innerText = "โณ ูู ุงูุชุธุงุฑ ุงุณุชุฌุงุจุฉ ุงููุฏูุฑ...";
                } else {
                    updateButtonStatus(orderBtn,"orderStatus",order.status);
                }
            }
        });
    });

};
</script>
</body>
</html>
