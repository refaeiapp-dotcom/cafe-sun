<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; background: #f9f9f9; }
    h2 { text-align: center; }
    #tableNumber { text-align: center; font-size: 18px; margin-bottom: 10px; color: #333; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #eee; }
    select, input[type="text"] { width: 100%; padding: 4px; }
    textarea { width: 100%; margin-top: 8px; padding: 6px; }
    button { margin: 5px 0; padding: 10px; width: 100%; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; }
    #orderBtn { background: #4CAF50; color: white; }
    #billBtn { background: #2196F3; color: white; display: none; }
    #callBtn { background: #FF9800; color: white; display: block; } /* Ø²Ø±Ø§Ø± Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
    #message { margin-top: 10px; text-align: center; font-weight: bold; }
    .order-box {
      background: #fff; border: 1px solid #ddd; border-radius: 8px;
      padding: 10px; margin: 10px 0;
    }
    .status-circle {
      width: 15px; height: 15px; border-radius: 50%; display: inline-block; margin-left: 8px;
    }
  </style>
</head>
<body>
  <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</h2>
  <div id="tableNumber"></div>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="menu"></tbody>
  </table>

  <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</h3>
  <textarea id="notes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea>

  <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="totalPrice">0</span> Ø¬Ù†ÙŠÙ‡</h3>

  <button id="orderBtn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
  <button id="billBtn">Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  <button id="callBtn">ğŸ“¢ Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
  <div id="message"></div>

  <h3>Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
  <div id="myOrders"></div>

  <div id="billSummary"></div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getDatabase, ref, set, push, update, onValue, get } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYYtMci_1laKbOxpVYaHsMx670WPhtNbk",
      authDomain: "my-restaurant-aba99.firebaseapp.com",
      projectId: "my-restaurant-aba99",
      storageBucket: "my-restaurant-aba99.appspot.com",
      messagingSenderId: "512969391867",
      appId: "1:512969391867:web:36a528665b3469871a3a5e",
      databaseURL: "https://my-restaurant-aba99-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    const items = [
      { name: "Ø´Ø§ÙŠ", price: 20 },
      { name: "Ù‚Ù‡ÙˆØ©", price: 25 },
      { name: "Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ", price: 45 },
      { name: "ÙƒÙˆÙÙŠ Ù…ÙƒØ³", price: 20 },
      { name: "ÙŠÙ†Ø³ÙˆÙ†", price: 25 },
      { name: "Ø­Ù„ÙŠØ©", price: 25 },
      { name: "ÙƒØ§ÙƒØ§Ùˆ", price: 45 },
      { name: "Ø³Ø­Ù„Ø¨ Ø³Ø§Ø¯Ø©", price: 50 },
      { name: "Ø³Ø­Ù„Ø¨ Ø¨Ø§Ù„Ù…ÙƒØ³Ø±Ø§Øª", price: 70 },
      { name: "Ø³Ø­Ù„Ø¨ ÙÙˆØ§ÙƒÙ‡", price: 70 },
      { name: "ØªÙˆØ³Øª", price: 40 },
      { name: "Ù‡ÙˆØª Ø³ÙŠØ¯Ø±", price: 60 },
      { name: "Ù„Ø§ØªÙŠÙ‡ Ø¨Ù†Ø¯Ù‚", price: 60 },
      { name: "Ù„Ø§ØªÙŠÙ‡ ÙØ§Ù†ÙŠÙ„ÙŠØ§", price: 60 },
      { name: "Ù„Ø§ØªÙŠÙ‡ ÙƒÙ„Ø§Ø³Ùƒ", price: 60 },
      { name: "Ø¨Ø±ÙŠÙ„", price: 40 },
      { name: "Ù…ÙŠØ§Ù‡", price: 10 },
      { name: "Ø¨ÙŠØ¨Ø³ÙŠ", price: 30 },
      { name: "Ù…ÙŠØ±Ù†Ø¯Ø§", price: 30 },
      { name: "Ø³ÙÙ† Ø§Ø¨", price: 30 },
      { name: "ÙÙŠØ±ÙˆØ²", price: 40 },
      { name: "Ø§Ø³ØªÙ†Ø¬", price: 40 },
      { name: "Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„", price: 80 },
      { name: "Ø¹ØµÙŠØ± Ù…Ø§Ù†Ø¬Ùˆ", price: 80 },
      { name: "Ø¹ØµÙŠØ± ÙØ±Ø§ÙˆÙ„Ø©", price: 80 },
      { name: "Ø¹Ù†Ø§Ø¨", price: 50 },
      { name: "Ù…ÙˆØ² Ø¨Ø§Ù„Ù„Ø¨Ù†", price: 80 },
      { name: "Ø²Ø¨Ø§Ø¯ÙŠ", price: 80 },
      { name: "Ø²Ø¨Ø§Ø¯ÙŠ Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡", price: 80 },
      { name: "Ø¢ÙŠØ³ ÙƒÙˆÙÙŠ", price: 70 },
      { name: "Ø¢ÙŠØ³ Ù„Ø§ØªÙŠÙ‡", price: 70 },
      { name: "Ø§ÙˆØ±ÙŠÙˆ", price: 70 },
      { name: "Ø±ÙŠØ¯ Ø¨ÙˆÙ„", price: 100 },
      { name: "Ø§ÙˆØ±ÙŠÙˆ Ù…Ù‚Ø§Ø±Ù†ÙŠØ´", price: 50 },
      { name: "Ù„ÙŠÙ…ÙˆÙ† Ù†Ø¹Ù†Ø§Ø¹", price: 50 },
      { name: "ÙØ±ÙˆØª Ø³Ù„Ø§Ø·", price: 120 },
      { name: "Ø¢ÙŠØ³ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", price: 80 },
      { name: "Ù‡ÙˆØª Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", price: 80 },
      { name: "Ù…ÙˆÙ‡ÙŠØªÙˆ", price: 70 },
      { name: "Ø­Ø¬Ø± Ø³Ù„ÙˆÙ…", price: 20 },
      { name: "Ø­Ø¬Ø± Ù‚Øµ", price: 20 },
      { name: "Ø­Ø¬Ø± ÙÙˆØ§ÙƒÙ‡", price: 100 },
      { name: "Ø­Ø¬Ø± Ù…ÙƒØ³", price: 100 }
    ];

    const menu = document.getElementById("menu");
    const totalPriceEl = document.getElementById("totalPrice");

    items.forEach((item, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.name}</td>
        <td>${item.price}</td>
        <td>
          <select id="qty-${index}">
            ${Array.from({length: 11}, (_,i) => `<option value="${i}">${i}</option>`).join("")}
          </select>
        </td>
        <td id="subtotal-${index}">0</td>
      `;
      menu.appendChild(tr);
      document.getElementById(`qty-${index}`).addEventListener("change", updateTotal);
    });

    function updateTotal() {
      let total = 0;
      items.forEach((item, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        const subtotal = qty * item.price;
        document.getElementById(`subtotal-${index}`).textContent = subtotal;
        total += subtotal;
      });
      totalPriceEl.textContent = total;
    }

    // Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const urlParams = new URLSearchParams(window.location.search);
    const tableNumber = urlParams.get("table") || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("tableNumber").textContent = "Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: " + tableNumber;

    const ordersRef = ref(db, "orders/table" + tableNumber);

    // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
    document.getElementById("orderBtn").addEventListener("click", () => {
      const order = items.map((item, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        return qty > 0 ? { name: item.name, price: item.price, qty } : null;
      }).filter(x => x);

      const notes = document.getElementById("notes").value;
      const total = totalPriceEl.textContent;

      if (order.length === 0) {
        document.getElementById("message").textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„";
        return;
      }

      const newOrderRef = push(ordersRef);
      set(newOrderRef, {
        status: "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",
        table: tableNumber,
        order: order,
        notes: notes,
        total: total
      });

      document.getElementById("message").textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";
      document.getElementById("billBtn").style.display = "block";

      resetQuantities();
    });

    // Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById("billBtn").addEventListener("click", async () => {
      const snapshot = await get(ordersRef);
      if (snapshot.exists()) {
        let grandTotal = 0;
        let allOrdersHtml = "<h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨:</h3>";

        snapshot.forEach(orderSnap => {
          const data = orderSnap.val();
          const thisTotal = parseInt(data.total, 10) || 0;
          grandTotal += thisTotal;

          allOrdersHtml += `<div class="order-box">`;
          allOrdersHtml += `<b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${data.status || ""}<ul>`;
          data.order.forEach(item => {
            allOrdersHtml += `<li>${item.name} Ã— ${item.qty} = ${item.qty * item.price}Ø¬</li>`;
          });
          allOrdersHtml += `</ul><p><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨:</b> ${thisTotal} Ø¬Ù†ÙŠÙ‡</p>`;
          allOrdersHtml += `</div>`;
        });

        allOrdersHtml += `<h3 style="color:blue">ğŸ’³ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${grandTotal} Ø¬Ù†ÙŠÙ‡</h3>`;
        document.getElementById("billSummary").innerHTML = allOrdersHtml;

        await update(ordersRef, { status: "Ø·Ù„Ø¨ Ø­Ø³Ø§Ø¨" });
        document.getElementById("message").textContent = "ğŸ’³ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨";
      }
    });

    // Ø²Ø±Ø§Ø± Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    document.getElementById("callBtn").addEventListener("click", async () => {
      await update(ordersRef, { alert: true });
      document.getElementById("message").textContent = "ğŸ“¢ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù†Ø¯Ø§Ø¡ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©";
    });

    // ØªØµÙÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ§Øª
    function resetQuantities() {
      items.forEach((item, index) => {
        document.getElementById(`qty-${index}`).value = 0;
        document.getElementById(`subtotal-${index}`).textContent = 0;
      });
      totalPriceEl.textContent = 0;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    onValue(ordersRef, (snapshot) => {
      const container = document.getElementById("myOrders");
      container.innerHTML = "";
      if (snapshot.exists()) {
        snapshot.forEach(orderSnap => {
          const data = orderSnap.val();
          let color = "gray";
          if (data.status === "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°") color = "red";
          else if (data.status === "Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±") color = "goldenrod";
          else if (data.status === "Ù…Ù†ØªÙ‡ÙŠ") color = "green";

          let html = `<div class="order-box">`;
          html += `<span class="status-circle" style="background:${color}"></span>`;
          html += `<b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${data.status || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}`;
          html += "<ul>";
          data.order.forEach(item => {
            html += `<li>${item.name} Ã— ${item.qty} = ${item.qty * item.price}Ø¬</li>`;
          });
          html += "</ul>";
          html += `<p><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b> ${data.total} Ø¬Ù†ÙŠÙ‡</p>`;
          if (data.notes) html += `<p><b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</b> ${data.notes}</p>`;
          html += `</div>`;
          container.innerHTML += html;
        });
      } else {
        container.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>";
      }
    });
  </script>
</body>
</html>
