<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 10px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; }
    th { background: #f2f2f2; }
    select, textarea { width: 100%; padding: 5px; font-size: 14px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; }
    #submitBtn { background: green; color: white; }
    #billBtn { background: blue; color: white; display: none; }
    #messageBox { margin-top: 15px; font-weight: bold; }
    #totalRow { font-weight: bold; background: #f9f9f9; }
  </style>
</head>
<body>

  <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ - Ø·Ø§ÙˆÙ„Ø© <span id="tableNumber"></span></h2>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="menuBody"></tbody>
    <tfoot>
      <tr id="totalRow">
        <td colspan="3">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</td>
        <td id="grandTotal">0 Ø¬Ù†ÙŠÙ‡</td>
      </tr>
    </tfoot>
  </table>

  <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
  <textarea id="notes" rows="3"></textarea>

  <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
  <div id="messageBox"></div>

  <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
  <button id="submitBtn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
  <button id="billBtn">Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</button>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYYtMci_1laKbOxpVYaHsMx670WPhtNbk",
      authDomain: "my-restaurant-aba99.firebaseapp.com",
      projectId: "my-restaurant-aba99",
      storageBucket: "my-restaurant-aba99.appspot.com",
      messagingSenderId: "512969391867",
      appId: "1:512969391867:web:36a528665b3469871a3a5e",
      measurementId: "G-XR5ZGKEZK8"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ø¬Ù„Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
    const urlParams = new URLSearchParams(window.location.search);
    const tableNumber = urlParams.get("table") || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
    document.getElementById("tableNumber").innerText = tableNumber;

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù
    const menu = [
      { name: "Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ", price: 20 },
      { name: "ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ", price: 25 },
      { name: "Ø´Ø§ÙŠ", price: 10 },
      { name: "Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„", price: 15 },
      { name: "Ø¹ØµÙŠØ± Ù…Ø§Ù†Ø¬Ùˆ", price: 18 },
      { name: "Ø¨ÙŠØ¨Ø³ÙŠ", price: 12 },
      { name: "Ù…ÙŠØ§Ù‡ Ù…Ø¹Ø¯Ù†ÙŠØ©", price: 7 },
      { name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ Ø¬Ø¨Ù†Ø©", price: 22 },
      { name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ Ø¨Ø±Ø¬Ø±", price: 35 },
      { name: "Ø¨ÙŠØªØ²Ø§ ØµØºÙŠØ±Ø©", price: 45 }
    ];

    const menuBody = document.getElementById("menuBody");
    menu.forEach((item, index) => {
      menuBody.innerHTML += `
        <tr>
          <td>${item.name}</td>
          <td>${item.price} Ø¬Ù†ÙŠÙ‡</td>
          <td>
            <select id="qty-${index}" onchange="updateTotals()">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </td>
          <td id="subtotal-${index}">0 Ø¬Ù†ÙŠÙ‡</td>
        </tr>
      `;
    });

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
    window.updateTotals = function() {
      let grandTotal = 0;
      menu.forEach((item, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        const subtotal = qty * item.price;
        document.getElementById(`subtotal-${index}`).innerText = subtotal + " Ø¬Ù†ÙŠÙ‡";
        grandTotal += subtotal;
      });
      document.getElementById("grandTotal").innerText = grandTotal + " Ø¬Ù†ÙŠÙ‡";
    };

    const messageBox = document.getElementById("messageBox");

    // Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
    document.getElementById("submitBtn").addEventListener("click", async () => {
      let orderItems = [];
      let total = 0;

      menu.forEach((item, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        if (qty > 0) {
          orderItems.push({ name: item.name, price: item.price, qty: qty, subtotal: qty * item.price });
          total += qty * item.price;
        }
      });

      const notes = document.getElementById("notes").value;

      if (orderItems.length === 0) {
        messageBox.style.color = "red";
        messageBox.innerText = "âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± ØµÙ†Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.";
        return;
      }

      try {
        await addDoc(collection(db, "orders"), {
          table: tableNumber,
          items: orderItems,
          notes: notes,
          total: total,
          status: "Ø¬Ø¯ÙŠØ¯",
          timestamp: new Date()
        });

        messageBox.style.color = "green";
        messageBox.innerText = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø±ÙŠØ¨Ù‹Ø§.";
        document.getElementById("submitBtn").style.display = "none";
        document.getElementById("billBtn").style.display = "inline-block";

      } catch (e) {
        messageBox.style.color = "red";
        messageBox.innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        console.error("Error adding document: ", e);
      }
    });

    // Ø²Ø± Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById("billBtn").addEventListener("click", () => {
      messageBox.style.color = "blue";
      messageBox.innerText = "ğŸ’³ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ Ø³ÙŠØ£ØªÙŠÙƒ Ø§Ù„Ù†Ø§Ø¯Ù„ Ù‚Ø±ÙŠØ¨Ù‹Ø§.";
    });
  </script>

</body>
</html>
