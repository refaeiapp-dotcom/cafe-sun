<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    select, input[type="number"] { padding: 5px; }
    textarea { width: 100%; height: 60px; margin-top: 10px; }
    button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
    #submitOrder { background: #28a745; color: white; display: block; margin: 10px auto; }
    #requestBill { background: #007bff; color: white; display: none; margin: 10px auto; }
    #statusMsg { text-align: center; margin-top: 10px; font-weight: bold; }
    #totalPrice { font-weight: bold; font-size: 18px; margin-top: 10px; text-align: center; }
  </style>
</head>
<body>

  <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ø·Ø§ÙˆÙ„Ø© <span id="tableNumber"></span></h2>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØµÙ†Ù</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="menuBody">
      <!-- Ø§Ù„Ø£ØµÙ†Ø§Ù Ù‡ØªØªÙˆÙ„Ø¯ Ù‡Ù†Ø§ -->
    </tbody>
  </table>

  <div id="totalPrice">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø¬.Ù…</div>

  <textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
  
  <button id="submitOrder">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
  <button id="requestBill">Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</button>

  <div id="statusMsg"></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYYtMci_1laKbOxpVYaHsMx670WPhtNbk",
      authDomain: "my-restaurant-aba99.firebaseapp.com",
      databaseURL: "https://my-restaurant-aba99-default-rtdb.firebaseio.com",
      projectId: "my-restaurant-aba99",
      storageBucket: "my-restaurant-aba99.appspot.com",
      messagingSenderId: "512969391867",
      appId: "1:512969391867:web:36a528665b3469871a3a5e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Ø£ØµÙ†Ø§Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    const menuItems = [
      { name: "Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ", price: 20 },
      { name: "Ù‚Ù‡ÙˆØ© Ø¥Ø³Ø¨Ø±ÙŠØ³Ùˆ", price: 25 },
      { name: "ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ", price: 30 },
      { name: "Ø´Ø§ÙŠ", price: 15 },
      { name: "Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„", price: 25 },
      { name: "Ø¹ØµÙŠØ± Ù…Ø§Ù†Ø¬Ùˆ", price: 28 },
      { name: "Ù…ÙŠØ§Ù‡ Ù…Ø¹Ø¯Ù†ÙŠØ©", price: 10 },
      { name: "Ø¨ÙŠØ¨Ø³ÙŠ", price: 18 },
      { name: "Ø³Ø§Ù†Ø¯ÙˆØªØ´ Ø¬Ø¨Ù†Ø©", price: 35 },
      { name: "Ø¨ÙŠØªØ²Ø§ ØµØºÙŠØ±Ø©", price: 60 }
    ];

    const menuBody = document.getElementById("menuBody");
    const totalPriceEl = document.getElementById("totalPrice");

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ?table=5
    const urlParams = new URLSearchParams(window.location.search);
    const tableNumber = urlParams.get("table") || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    document.getElementById("tableNumber").textContent = tableNumber;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    menuItems.forEach((item, index) => {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.price} Ø¬.Ù…</td>
        <td>
          <select id="qty-${index}">
            <option value="0">0</option>
            ${[...Array(11).keys()].slice(1).map(n => `<option value="${n}">${n}</option>`).join("")}
          </select>
        </td>
        <td id="total-${index}">0 Ø¬.Ù…</td>
      `;

      menuBody.appendChild(row);

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„ÙƒÙ„ ØµÙ†Ù
      document.getElementById(`qty-${index}`).addEventListener("change", () => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        const subtotal = qty * item.price;
        document.getElementById(`total-${index}`).textContent = subtotal + " Ø¬.Ù…";
        updateTotal();
      });
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ
    function updateTotal() {
      let total = 0;
      menuItems.forEach((item, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        total += qty * item.price;
      });
      totalPriceEl.textContent = "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + total + " Ø¬.Ù…";
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
    document.getElementById("submitOrder").addEventListener("click", () => {
      let order = [];
      let total = 0;

      menuItems.forEach((item, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        if (qty > 0) {
          order.push({ name: item.name, price: item.price, qty, subtotal: qty * item.price });
          total += qty * item.price;
        }
      });

      const notes = document.getElementById("notes").value;

      const ordersRef = ref(db, "orders");
      push(ordersRef, {
        table: tableNumber,
        order,
        notes,
        total,
        status: "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"
      });

      document.getElementById("statusMsg").textContent = "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù„Ù„Ø¨ÙˆÙÙŠÙ‡";
      document.getElementById("requestBill").style.display = "block";
    });

    // Ø·Ù„Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById("requestBill").addEventListener("click", () => {
      document.getElementById("statusMsg").textContent = "ğŸ’³ Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø³ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø­Ø³Ø§Ø¨.";
    });

  </script>
</body>
</html>
