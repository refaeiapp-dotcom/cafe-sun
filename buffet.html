<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙˆÙÙŠÙ‡</title>
  <style>
    body { font-family: Tahoma, Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { text-align: center; color: darkblue; }
    .order-box {
      background: white; padding: 15px; margin: 10px auto;
      border-radius: 8px; border: 1px solid #ccc; max-width: 500px;
      text-align: right;
    }
    .order-box h3 { margin: 0 0 10px; color: darkred; }
    .order-box ul { margin: 0; padding-right: 20px; }
    button {
      margin-top: 10px; padding: 8px 16px; border: none; border-radius: 5px;
      cursor: pointer; font-weight: bold; color: white;
    }
    .done-btn { background: green; }
  </style>
</head>
<body>
  <h1>ğŸ½ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙˆÙÙŠÙ‡</h1>
  <div id="orders"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYYtMci_1laKbOxpVYaHsMx670WPhtNbk",
      authDomain: "my-restaurant-aba99.firebaseapp.com",
      projectId: "my-restaurant-aba99",
      storageBucket: "my-restaurant-aba99.appspot.com",
      messagingSenderId: "512969391867",
      appId: "1:512969391867:web:36a528665b3469871a3a5e",
      databaseURL: "https://my-restaurant-aba99-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ordersDiv = document.getElementById("orders");

    // ğŸ”¹ Ø±Ø§Ù‚Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ø¨ÙˆÙÙŠÙ‡
    const buffetRef = ref(db, "buffet");
    onValue(buffetRef, (snapshot) => {
      ordersDiv.innerHTML = "";
      if (snapshot.exists()) {
        snapshot.forEach(tableSnap => {
          const tableNumber = tableSnap.key.replace("table", "");
          tableSnap.forEach(orderSnap => {
            const orderId = orderSnap.key;
            const data = orderSnap.val();

            let html = `<div class="order-box">`;
            html += `<h3>Ø·Ø§ÙˆÙ„Ø© ${tableNumber} - Ø§Ù„Ø­Ø§Ù„Ø©: ${data.status || ""}</h3>`;
            if (data.order) {
              html += "<ul>";
              data.order.forEach(item => {
                html += `<li>${item.name} Ã— ${item.qty} = ${item.qty * item.price}Ø¬</li>`;
              });
              html += "</ul>";
            }
            html += `<p><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</b> ${data.total} Ø¬Ù†ÙŠÙ‡</p>`;
            if (data.notes) html += `<p><b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</b> ${data.notes}</p>`;
            html += `<button class="done-btn" onclick="markAsDone('${tableNumber}','${orderId}')">âœ… ØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²</button>`;
            html += `</div>`;
            ordersDiv.innerHTML += html;
          });
        });
      } else {
        ordersDiv.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
      }
    });

    // ğŸ”¹ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
    window.markAsDone = function(tableNumber, orderId) {
      set(ref(db, `buffet/table${tableNumber}/${orderId}/status`), "Ù…Ù†ØªÙ‡ÙŠ");
      set(ref(db, `orders/table${tableNumber}/${orderId}/status`), "Ù…Ù†ØªÙ‡ÙŠ");
    }
  </script>
</body>
</html>
