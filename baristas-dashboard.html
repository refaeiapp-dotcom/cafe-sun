<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة متابعة العمال</title>
  <style>
    body {
      font-family: Tahoma, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
      text-align: center;
    }
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px;
    }
    .barista {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    .barista h2 {
      margin: 5px 0 15px;
      color: darkblue;
      font-size: 18px;
    }
    .order {
      background: #f1f1f1;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      text-align: right;
    }
    .order h3 {
      margin: 0 0 5px 0;
    }
    .status {
      font-weight: bold;
      padding: 3px 6px;
      border-radius: 6px;
      display: inline-block;
      margin-top: 5px;
    }
    .red { background: crimson; color: white; }
    .yellow { background: goldenrod; color: black; }
    .green { background: seagreen; color: white; }
  </style>
</head>
<body>

  <h1>📊 لوحة متابعة العمال</h1>

  <div class="grid">
    <div class="barista"><h2 id="title1">👤 Barista 1</h2><div id="barista1"></div></div>
    <div class="barista"><h2 id="title2">👤 Barista 2</h2><div id="barista2"></div></div>
    <div class="barista"><h2 id="title3">👤 Barista 3</h2><div id="barista3"></div></div>
    <div class="barista"><h2 id="title4">👤 Barista 4</h2><div id="barista4"></div></div>
    <div class="barista"><h2 id="title5">👤 Barista 5</h2><div id="barista5"></div></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    // ✅ إعدادات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAYYtMci_1laKbOxpVYaHsMx670WPhtNbk",
      authDomain: "my-restaurant-aba99.firebaseapp.com",
      projectId: "my-restaurant-aba99",
      storageBucket: "my-restaurant-aba99.appspot.com",
      messagingSenderId: "512969391867",
      appId: "1:512969391867:web:36a528665b3469871a3a5e",
      databaseURL: "https://my-restaurant-aba99-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ✅ تحميل الطلبات وتوزيعها حسب assignedTo
    const ordersRef = ref(db, "orders");
    onValue(ordersRef, (snapshot) => {
      // مسح الأعمدة قبل التحديث
      for (let i = 1; i <= 5; i++) {
        document.getElementById("barista" + i).innerHTML = "";
        document.getElementById("title" + i).textContent = "👤 Barista " + i + " (0 طلب)";
      }

      // عداد الطلبات
      const counters = { barista1:0, barista2:0, barista3:0, barista4:0, barista5:0 };

      if (snapshot.exists()) {
        snapshot.forEach((child) => {
          const data = child.val();
          if (data.assignedTo) {
            const div = document.createElement("div");
            div.className = "order";
            div.innerHTML = `
              <h3>🍽️ طاولة ${data.table}</h3>
              <ul>
                ${data.order.map(item => `<li>${item.name} × ${item.qty} = ${item.qty * item.price}ج</li>`).join("")}
              </ul>
              <p><b>الإجمالي:</b> ${data.total} جنيه</p>
              ${data.notes ? `<p><b>ملاحظات:</b> ${data.notes}</p>` : ""}
              <span class="status ${statusColor(data.status)}">${data.status || "غير محدد"}</span>
            `;
            // إضافة للعمود الخاص بالعامل
            const col = document.getElementById(data.assignedTo);
            if (col) {
              col.appendChild(div);
              counters[data.assignedTo]++;
            }
          }
        });
      }

      // تحديث العناوين بعد العد
      for (let i = 1; i <= 5; i++) {
        document.getElementById("title" + i).textContent = `👤 Barista ${i} (${counters["barista"+i]} طلب)`;
      }
    });

    function statusColor(status) {
      switch (status) {
        case "قيد التنفيذ": return "red";
        case "قيد التحضير": return "yellow";
        case "منتهي": return "green";
        default: return "";
      }
    }
  </script>
</body>
</html>
